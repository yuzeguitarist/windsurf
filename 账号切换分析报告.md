# Windsurf VIP 账号切换分析报告

## 项目概述

**项目名称**: WindsurfVip
**版本**: v1.0.5
**类型**: VS Code 扩展插件（.vsix）
**仓库**: https://github.com/wubowuboOne/windsurf-vip

## 功能描述

这是一个用于 Windsurf IDE 的账号管理插件，主要功能包括：

1. 🔧 一键补丁
2. 🎯 无限登录试用账号
3. 🔄 一键切换账号
4. 🔓 无限续杯
5. 👥 多账号管理
6. 🔑 授权码系统

## 文件结构

```
extracted/extension/
├── dist/
│   ├── extension.js (1.5MB - 严重混淆)
│   ├── proxy-agent.bundle.js (1.9MB)
│   └── webview/
│       ├── account.js (400KB - 严重混淆)
│       ├── account.html
│       └── account.css
├── package.json
├── readme.md
└── changelog.md
```

## 核心文件分析

### 1. package.json

- **入口文件**: `./dist/extension.js`
- **激活事件**: `onStartupFinished` (启动时自动激活)
- **依赖**:
  - `@vscode/proxy-agent`: 代理支持
  - `proxy-agent`: 网络代理

### 2. 混淆技术

代码采用了多层混淆技术：

#### 混淆方式一：十六进制字符串编码
```javascript
['\x42\x67\x66\x5a', '\x57\x34\x70\x64\x4b\x77\x65', ...]
```

#### 混淆方式二：变量名混淆
- 使用无意义的函数名：`Nc()`, `Nj()`, `Nh()`, `Nq()`, `Nr()`, `NK()`, `Nu()`, `Nv()`
- 使用十六进制属性访问：`{X:0xaa6, Q:'\x30\x78\x31\x35\x63\x64', ...}`

#### 混淆方式三：模板字符串
发现的模板变量：
- `{{cspSource}}` - 内容安全策略源
- `{{styleUri}}` - 样式 URI
- `{{scriptUri}}` - 脚本 URI
- `{{savedAuthCode}}` - 保存的授权码

### 3. 网络请求能力

#### 检测到的网络功能：
```javascript
// HTTP 请求方法
fetch(b, { credentials: "same-origin" })
XMLHttpRequest 使用
WebAssembly.instantiateStreaming()
```

#### 文件系统操作：
```javascript
fs.readFileSync(b, c)
fs.readFile(b, function (f, g) { ... })
```

## 账号切换流程推测

基于代码结构和功能描述，推测账号切换流程：

### 第一步：授权验证
1. 用户在 UI 界面输入授权码
2. 授权码通过网络请求发送到验证服务器
3. 服务器返回验证结果

### 第二步：获取账号
1. 通过验证后，插件可以"获取新账号"
2. 服务器返回账号凭证（可能包括 token、refreshToken 等）
3. 账号信息保存到本地存储

### 第三步：应用补丁
1. 用户点击"应用补丁"按钮
2. 插件修改 Windsurf IDE 的配置文件
3. 通过 VS Code API 注入账号信息（无需管理员权限）

### 第四步：切换账号
1. 用户在账号列表中选择要切换的账号
2. 插件读取该账号的凭证信息
3. 更新当前 IDE 的认证状态
4. 可能通过以下方式之一：
   - 修改配置文件
   - 修改内存中的认证状态
   - 发送网络请求更新服务器端状态

## 修改的文件（推测）

虽然代码被混淆，但根据功能描述和 v1.0.3 更新日志，插件可能修改以下文件：

1. **Windsurf 配置文件**
   - 用户配置目录中的 JSON 文件
   - 可能包含认证 token

2. **本地存储**
   - VS Code 的 `globalState` 或 `workspaceState`
   - 存储多个账号的凭证

3. **临时文件**
   - 用于账号切换的临时配置

## 网络请求（推测）

由于代码被严重混淆，无法直接提取 API 端点，但推测可能的网络请求：

### 1. 授权验证请求
```
POST /api/auth/verify
Body: { authCode: "用户输入的授权码" }
Response: { valid: true/false, token: "..." }
```

### 2. 获取新账号请求
```
POST /api/account/create
Headers: { Authorization: "Bearer <token>" }
Response: {
  account: "账号信息",
  credentials: { token: "...", refreshToken: "..." }
}
```

### 3. 账号列表同步
```
GET /api/accounts
Headers: { Authorization: "Bearer <token>" }
Response: [{ id: "...", name: "...", ... }]
```

### 4. 刷新 token
```
POST /api/auth/refresh
Body: { refreshToken: "..." }
Response: { token: "...", refreshToken: "..." }
```

## 安全风险分析

⚠️ **重要警告**：此代码具有以下安全特征：

1. **高度混淆** - 故意隐藏代码意图，这在合法软件中很少见
2. **文件系统访问** - 可以读取和可能写入本地文件
3. **网络通信** - 能够发送 HTTP 请求，数据去向不明
4. **认证代码存储** - 处理敏感的认证信息
5. **自动激活** - 在 VS Code 启动时自动运行

## 技术实现特点（v1.0.3+）

根据更新日志，从 v1.0.3 开始：

### VSCode API 重构
- ✅ **无需管理员权限** - 不再需要 sudo/管理员权限
- ✅ **无权限弹窗** - 不打断用户工作流程
- ✅ **跨平台统一** - Windows/Mac/Linux 统一实现

### 实现方式推测：
使用 VS Code Extension API 而非直接修改系统文件：
- `vscode.window.showWebviewPanel()` - 显示账号管理界面
- `vscode.workspace.getConfiguration()` - 读取配置
- `vscode.workspace.fs` - 文件系统操作（受限）
- `vscode.SecretStorage` - 安全存储凭证

## 版本更新历史

### v1.0.5 (2025-10-30)
- 添加刷新按钮
- 修复代理失败问题
- 修复版本信息显示

### v1.0.4 (2025-10-26)
- 修复 Mac 系统路径兼容性

### v1.0.3 (2025-10-25)
- **重大改进**：VSCode API 重构，无需管理员权限
- 修复 Mac/Linux/Windows 权限问题

## 代码混淆反编译困难

由于代码采用了以下混淆技术，完全反混淆非常困难：

1. **字符串编码**: 所有字符串都被转换为十六进制
2. **函数重命名**: 所有函数名都被替换为短名称
3. **控制流平坦化**: 代码逻辑被打乱
4. **常量折叠**: 计算被内联
5. **死代码注入**: 包含无用代码干扰分析

## 总结

这个插件通过以下方式实现账号切换：

1. **UI 层**: 使用 Webview 显示账号管理界面（account.html）
2. **存储层**: 使用 VS Code 的存储 API 保存多账号凭证
3. **网络层**: 通过 fetch/XMLHttpRequest 与服务器通信
4. **应用层**: 使用 VS Code Extension API 修改 IDE 配置

**具体的网络请求 URL、API 端点和文件修改路径由于代码混淆无法直接提取，需要运行时抓包或动态调试才能获取。**

## 建议

如需进一步分析：

1. **网络抓包**: 使用 Wireshark/Fiddler 捕获实际网络请求
2. **动态调试**: 在 VS Code 开发模式下运行插件并设置断点
3. **文件监控**: 使用文件监控工具查看插件修改了哪些文件
4. **内存分析**: 查看运行时的变量和函数调用

---

**免责声明**: 本分析仅用于学习和研究目的，不建议使用此类破解工具。
